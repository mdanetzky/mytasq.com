/* 
 * Copyright 2013 MyTasq.com
 * Author: Matthias Danetzky
 */

define(["mt.backbone.sio","underscore","mt.util","jquery","mt.spinner","mt.message.box"],function(e,t,n,r,i,s){var o=e.View.extend({formChanged:!1,el:"#userLoginForm",initialize:function(){this.copyAndValidate()},events:{"click #userLoginSend":"validateAndSend","input #userLoginEmail":"formInput","input #userLoginPassword":"formInput","input #userLoginRememberMe":"formInput"},validateAndSend:function(){self=this,r("#userLoginSend").attr("disabled","disabled"),i.show(),this.model.save({},{success:function(e,t,n){self.copyAndValidate(),i.hide(),self.formChanged&&r("#userLoginForm").submit()},error:function(e){self.copyAndValidate(),i.hide(),s("Login failed!")}})},formInput:function(){this.formChanged=!0,this.copyAndValidate()},copyAndValidate:function(){var e=!0;this.model.set("email",r("#userLoginEmail").val()),this.model.set("password",r("#userLoginPassword").val()),this.model.set("rememberme",r("#userLoginRememberMe").attr("checked")),n.validateEmail(this.model.get("email"))?(r("#userLoginEmailCG").removeClass("error"),r("#userLoginEmailCG").addClass("success")):(e=!1,r("#userLoginEmailCG").removeClass("success"),r("#userLoginEmailCG").addClass("error")),this.model.get("password")?(r("#userLoginPasswordCG").removeClass("error"),r("#userLoginPasswordCG").addClass("success")):(e=!1,r("#userLoginPasswordCG").removeClass("success"),r("#userLoginPasswordCG").addClass("error")),e?r("#userLoginSend").removeAttr("disabled"):(r("#userLoginSend").attr("disabled","disabled"),r("#userLoginSend").removeAttr("disabled"))}});return o});