define(["./normalize"],function(e){function t(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}if(typeof window=="undefined")return{load:function(e,t,n){n()}};var n=!1,r=document.getElementsByTagName("head")[0],i=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),s=!1;!i||(i[1]||i[7]?(s=parseInt(i[1])<6||parseInt(i[7])<=9,i="trident"):i[2]?(s=!0,i="webkit"):i[3]||(i[4]?(s=parseInt(i[4])<18,i="gecko"):n&&alert("Engine detection failed")));var o={};o.bufferLoaded={},o.pluginBuilder="./css-builder";var u=[];o.addBuffer=function(e){u.indexOf(e)==-1&&u.push(e)},o.setBuffer=function(t,n){var r=window.location.pathname.split("/");r.pop(),r=r.join("/")+"/";var i=require.toUrl("base_url").split("/");i.pop();var s=i.join("/")+"/";s=e.convertURIBase(s,r,"/"),s.substr(0,1)!="/"&&(s="/"+s),s.substr(s.length-1,1)!="/"&&(s+="/"),o.inject(e(t,s,r));for(var a=0;a<u.length;a++)o.bufferLoaded[u[a]]&&o.bufferLoaded[u[a]]!==!0&&(!n&&u[a].substr(u[a].length-4,4)==".css"||n&&u[a].substr(u[a].length-5,5)==".less")&&setTimeout(o.bufferLoaded[u[a]],7)};var a=function(e,t){setTimeout(function(){for(var n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n];if(r.href==e.href)return t()}a(e,t)},10)},f=function(e,t){setTimeout(function(){try{return e.sheet.cssRules,t()}catch(n){}f(e,t)},10)};if(i=="trident"&&s)var l=[],c=[],h=0,p=function(e,t){var n;c.push({url:e,cb:t}),n=l.shift(),!n&&h++<12&&(n=document.createElement("style"),r.appendChild(n)),d(n)},d=function(e){var t=c.shift();if(!t){e.onload=m,l.push(e);return}e.onload=function(){t.cb(t.ss),d(e)};var n=e.styleSheet;t.ss=n.imports[n.addImport(t.url)]};var v=function(e){var t=document.createElement("link");return t.type="text/css",t.rel="stylesheet",t.href=e,t},m=function(){};o.linkLoad=function(e,t){var o=setTimeout(function(){n&&alert("timeout"),t()},T*1e3-100),u=function(){clearTimeout(o),l&&(l.onload=m),setTimeout(t,7)};if(!s){var l=v(e);l.onload=u,r.appendChild(l)}else if(i=="webkit"){var l=v(e);a(l,u),r.appendChild(l)}else if(i=="gecko"){var c=document.createElement("style");c.textContent='@import "'+e+'"',f(c,u),r.appendChild(c)}else i=="trident"&&p(e,u)};var g=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],y={},b=function(e,t,n){if(y[e]){t(y[e]);return}var r,i,s;if(typeof XMLHttpRequest!="undefined")r=new XMLHttpRequest;else if(typeof ActiveXObject!="undefined")for(i=0;i<3;i+=1){s=g[i];try{r=new ActiveXObject(s)}catch(o){}if(r){g=[s];break}}r.open("GET",e,requirejs.inlineRequire?!1:!0),r.onreadystatechange=function(i){var s,o;r.readyState===4&&(s=r.status,s>399&&s<600?(o=new Error(e+" HTTP status: "+s),o.xhr=r,n(o)):(y[e]=r.responseText,t(r.responseText)))},r.send(null)},w=document.createElement("style");w.type="text/css",r.appendChild(w),w.styleSheet?o.inject=function(e){w.styleSheet.cssText+=e}:o.inject=function(e){w.appendChild(document.createTextNode(e))};var E=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,S=window.location.pathname.split("/");S.pop(),S=S.join("/")+"/";var x=function(t,n,r){t.substr(0,1)!="/"&&(t="/"+e.convertURIBase(t,S,"/")),b(t,function(i){i=e(i,t,S);var s=[],o=[],u=[],a;while(a=E.exec(i)){var f=a[4]||a[5]||a[7]||a[8]||a[9];s.push(f),o.push(E.lastIndex-a[0].length),u.push(a[0].length)}var l=0;for(var c=0;c<s.length;c++)(function(e){x(s[e],function(t){i=i.substr(0,o[e])+t+i.substr(o[e]+u[e]);var r=t.length-u[e];for(var a=e+1;a<s.length;a++)o[a]+=r;l++,l==s.length&&n(i)},r)})(c);s.length==0&&n(i)},r)};o.normalize=function(e,t){return e.substr(e.length-4,4)==".css"&&(e=e.substr(0,e.length-4)),t(e)};var T,N=!1;return o.load=function(e,t,r,i,a){T=T||i.waitSeconds||7;var f=e+(a?".less":".css");for(var l=0;l<u.length;l++)if(u[l]==f){o.bufferLoaded[f]===!0?r():o.bufferLoaded[f]=r;return}f=t.toUrl(f),!N&&n&&(alert(s?"hacking links":"not hacking"),N=!0),a?(f.indexOf(".less")===-1&&a&&(f+=".less"),x(f,function(e){a&&(e=a(e,function(e){o.inject(e),setTimeout(r,7)}))})):o.linkLoad(f,r)},n&&(o.inspect=function(){if(w.styleSheet)return w.styleSheet.cssText;if(w.innerHTML)return w.innerHTML}),o});